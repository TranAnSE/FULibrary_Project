@model LibraryManagementClient.Models.BookDetailDto
@{
    ViewData["Title"] = Model.Title;
}

<div class="row mb-3">
    <div class="col-12">
        <a asp-controller="Home" asp-action="Index" class="btn btn-outline-secondary btn-sm">
            <i class="fas fa-arrow-left me-2"></i>Back to Home
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-4 mb-4">
        @if (!string.IsNullOrEmpty(Model.CoverImageUrl))
        {
            <img src="@Model.CoverImageUrl" class="img-fluid shadow-md rounded" alt="@Model.Title" />
        }
        else
        {
            <div class="card shadow-md" style="height: 400px;">
                <div class="card-body d-flex align-items-center justify-content-center bg-light">
                    <i class="fas fa-book text-muted" style="font-size: 6rem;"></i>
                </div>
            </div>
        }
    </div>

    <div class="col-md-8">
        <div class="card shadow-sm mb-4">
            <div class="card-header">
                <h3 class="mb-0">@Model.Title</h3>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">
                        <i class="fas fa-user me-2 text-primary"></i>Author:
                    </div>
                    <div class="col-sm-8">
                        @(Model.Author ?? "Unknown")
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.ISBN))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-barcode me-2 text-primary"></i>ISBN:
                        </div>
                        <div class="col-sm-8">
                            @Model.ISBN
                        </div>
                    </div>
                }

                @if (Model.PublicationYear.HasValue)
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-calendar me-2 text-primary"></i>Publication Year:
                        </div>
                        <div class="col-sm-8">
                            @Model.PublicationYear
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.PublisherName))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-building me-2 text-primary"></i>Publisher:
                        </div>
                        <div class="col-sm-8">
                            @Model.PublisherName
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.CategoryName))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-folder me-2 text-primary"></i>Category:
                        </div>
                        <div class="col-sm-8">
                            @Model.CategoryName
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.LanguageName))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-language me-2 text-primary"></i>Language:
                        </div>
                        <div class="col-sm-8">
                            @Model.LanguageName
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.DDC))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-tag me-2 text-primary"></i>DDC:
                        </div>
                        <div class="col-sm-8">
                            @Model.DDC
                        </div>
                    </div>
                }

                <div class="row mb-3">
                    <div class="col-sm-4 fw-bold">
                        <i class="fas fa-building me-2 text-primary"></i>Library:
                    </div>
                    <div class="col-sm-8">
                        @Model.LibraryName
                    </div>
                </div>

                @if (!string.IsNullOrEmpty(Model.Subject))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-book me-2 text-primary"></i>Subject:
                        </div>
                        <div class="col-sm-8">
                            @Model.Subject
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.Keyword))
                {
                    <div class="row mb-3">
                        <div class="col-sm-4 fw-bold">
                            <i class="fas fa-key me-2 text-primary"></i>Keywords:
                        </div>
                        <div class="col-sm-8">
                            @Model.Keyword
                        </div>
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.Description))
                {
                    <hr />
                    <div class="mt-3">
                        <h6 class="fw-bold">
                            <i class="fas fa-align-left me-2 text-primary"></i>Description:
                        </h6>
                        <p class="text-muted">@Model.Description</p>
                    </div>
                }
            </div>
        </div>

        <!-- Availability Section - Only for authenticated users -->
        @if (ViewBag.ShowAvailability == true && Model.Copies.Any())
        {
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-check-circle me-2"></i>Availability
                    </h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead>
                                <tr>
                                    <th>Registration Number</th>
                                    <th>Location</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var copy in Model.Copies)
                                {
                                    <tr>
                                        <td>@copy.RegistrationNumber</td>
                                        <td>@(copy.ShelfLocationCode ?? "N/A")</td>
                                        <td>
                                            @if (copy.Status == "Available")
                                            {
                                                <span class="badge bg-success">
                                                    <i class="fas fa-check me-1"></i>Available
                                                </span>
                                            }
                                            else if (copy.Status == "Borrowed")
                                            {
                                                <span class="badge bg-warning">
                                                    <i class="fas fa-clock me-1"></i>Borrowed
                                                </span>
                                            }
                                            else
                                            {
                                                <span class="badge bg-danger">
                                                    <i class="fas fa-times me-1"></i>@copy.Status
                                                </span>
                                            }
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                    <div class="mt-3 text-center">
                        <p class="text-muted mb-0">
                            <i class="fas fa-info-circle me-1"></i>
                            @Model.Copies.Count(c => c.Status == "Available") of @Model.Copies.Count copies available
                        </p>
                    </div>
                </div>
            </div>
        }
        else if (!User.Identity?.IsAuthenticated == true)
        {
            <div class="card bg-light">
                <div class="card-body text-center">
                    <i class="fas fa-lock text-muted mb-3" style="font-size: 2rem;"></i>
                    <h5>Login to View Availability</h5>
                    <p class="text-muted">
                        Sign in with your library account to check availability and borrow books
                    </p>
                    <a asp-controller="Auth" asp-action="Login" class="btn btn-primary">
                        <i class="fas fa-sign-in-alt me-2"></i>Login
                    </a>
                </div>
            </div>
        }
    </div>
</div>
